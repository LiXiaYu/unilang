$import! std.classes make-class make-object;
$import! UnilangQt QWidget;

() newline;

$defl! log (x) (display x; () newline);
$defl! logd (x) (log "DEBUG:"; log x);

logd "Loading script ...";

$def! global () get-current-environment;
$def! MyWidget make-class QWidget ($lambda (self)
(
	logd "[ctor] MyWidget";
	$set! self hello list "Hallo Welt" "Hei maailma" "Hola Mundo" "Привет мир";
	$set! self button make-QPushButton "Click me!";
	$set! self text make-QLabel "Hello World!" Qt.AlignCenter;
	$set! self layout () make-QVBoxLayout;
	$import! self text button layout;
	QLayout-addWidget layout text;
	QLayout-addWidget layout button;
	($remote-eval setLayout self) layout;
	QObject-connect button "clicked(bool)" ($remote-eval _dynamic self)
		($lambda/e (make-environment self global) () (
		logd "[slot] Callback called.";
		QLabel-setText text (random.choice hello)
	))
));

$def! app () make-QApplication;
$def! wgt make-object MyWidget;
($remote-eval resize wgt) 800 600;
() ($remote-eval show wgt);
sys.exit (() QApplication-exec);

